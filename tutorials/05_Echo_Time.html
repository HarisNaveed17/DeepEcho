

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Handling DateTime Values &mdash; DeepEcho 0.0.2.dev0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="deepecho package" href="../api/deepecho.html" />
    <link rel="prev" title="Event-based Data" href="04_Event_Data.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #0095B2" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/header-light.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Getting_Started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="01_Getting_Started.html#Load-the-dataset">Load the dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Getting_Started.html#Explore-the-dataset">Explore the dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_Getting_Started.html#Using-the-PAR-Model">Using the PAR Model</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="02_Model_API.html">Model API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="02_Model_API.html#Fit">Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_Model_API.html#Sample">Sample</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03_Seasonal_Trends.html">Seasonal Trends</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Event_Data.html">Event-based Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Handling DateTime Values</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#What-is-1594536602?">What is 1594536602?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-Timestamps">Generating Timestamps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Modeling-Distributions">Modeling Distributions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Continuous-Values">Continuous Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Timestamps-as-Continuous-Values">Timestamps as Continuous Values</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Modeling-Timestamps">Modeling Timestamps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Motivating-Example">Motivating Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#As-Input">As Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#As-Output">As Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Implementation">Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Demo">Demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Direct-Modeling">Direct Modeling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Using-EchoTime">Using EchoTime</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Takeaways">Takeaways</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/deepecho.html">DeepEcho API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/deepecho.html#submodules">Submodules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/deepecho.base.html">deepecho.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/deepecho.par.html">deepecho.par module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/deepecho_benchmark.html">Benchmark API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/deepecho_benchmark.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/deepecho_benchmark.tasks.html">deepecho_benchmark.tasks package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/deepecho_benchmark.tasks.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/deepecho_benchmark.html#submodules">Submodules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/deepecho_benchmark.benchmark.html">deepecho_benchmark.benchmark module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/deepecho_benchmark.classifier.html">deepecho_benchmark.classifier module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/deepecho_benchmark.download.html">deepecho_benchmark.download module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#types-of-contributions">Types of Contributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#report-bugs">Report Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#fix-bugs">Fix Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#implement-features">Implement Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#write-documentation">Write Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#submit-feedback">Submit Feedback</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#unit-testing-guidelines">Unit Testing Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#tips">Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html#release-workflow">Release Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../contributing.html#release-candidates">Release Candidates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../authors.html#development-lead">Development Lead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authors.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../history.html#id1">0.0.1 (2020-07-11)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DeepEcho</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Handling DateTime Values</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/k15z/DeepEcho/blob/master/docs/tutorials/05_Echo_Time.ipynb" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Handling-DateTime-Values">
<h1>Handling DateTime Values<a class="headerlink" href="#Handling-DateTime-Values" title="Permalink to this headline">¶</a></h1>
<div class="section" id="What-is-1594536602?">
<h2>What is 1594536602?<a class="headerlink" href="#What-is-1594536602?" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with the (overly optimistic) assumption that all datetime value are represented as Unix time.</p>
<p><em>Note: This assumption fails when we have to take into account things like how the value should be presented (i.e. time zones, 1997-12-12 vs 12/12/1996, etc.).</em></p>
<p>Now suppose we have the following dataset:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="mi">1577836800</span><span class="p">,</span> <span class="s2">&quot;nb_customers&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="mi">1578182400</span><span class="p">,</span> <span class="s2">&quot;nb_customers&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="mi">1578441600</span><span class="p">,</span> <span class="s2">&quot;nb_customers&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="mi">1578787200</span><span class="p">,</span> <span class="s2">&quot;nb_customers&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<p>If we were trying to apply standard machine learning algorithms to, for example, predict the number of customers on a given day, our path forward would be simple. We would use some feature engineering methods to transform the datetime into more easily interpretable features for the model.</p>
<p>For example, in this case, if we added a <code class="docutils literal notranslate"><span class="pre">day_of_week</span></code> feature, then our model would easily learn that there are more customers on Sundays than Wednesdays.</p>
</div>
<div class="section" id="Generating-Timestamps">
<h2>Generating Timestamps<a class="headerlink" href="#Generating-Timestamps" title="Permalink to this headline">¶</a></h2>
<p>Feature extraction is a powerful tool for discriminative models… but it’s not clear how to translate those ideas into a generative framework such as <strong>DeepEcho</strong>.</p>
<blockquote>
<div><p><em>In fact, to the best of my knowledge, there exist no papers in the space of synthetic data generation, generative adversarial networks, autoregressive models, etc. which discuss how to generate timestamps.</em></p>
</div></blockquote>
<p>The default way to handle time stamp values appears to be involve simply normalizing the Unix timestamp into a value in <span class="math notranslate nohighlight">\([-1.0, 1.0]\)</span> based on the minimum and maximum timestamp in the data and treating it as a real number.</p>
<div class="section" id="Modeling-Distributions">
<h3>Modeling Distributions<a class="headerlink" href="#Modeling-Distributions" title="Permalink to this headline">¶</a></h3>
<p>Within <strong>DeepEcho</strong>, our models tend to generate as outputs distributions over data (as opposed to producing the actual synthetic data). This is important as it allows us to separate the sampling stage from the modeling stage, particularly in the case of autoregressive models which would otherwise be deterministic.</p>
<div class="section" id="Continuous-Values">
<h4>Continuous Values<a class="headerlink" href="#Continuous-Values" title="Permalink to this headline">¶</a></h4>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">PARModel</span></code>, when modeling continuous values, our model outputs three values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mu</span></code> - the mean of the Normal distribution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var</span></code> - the variance of the Normal distribution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">missing</span></code> - the probability that the value is misisng</p></li>
</ul>
<p>which we can use to generate a value by (1) sampling whether the value is missing and (2) if the value is not missing, sampling from the Normal distribution with the given mean and variance.</p>
</div>
<div class="section" id="Timestamps-as-Continuous-Values">
<h4>Timestamps as Continuous Values<a class="headerlink" href="#Timestamps-as-Continuous-Values" title="Permalink to this headline">¶</a></h4>
<p>This works well for a wide variety of continuous-valued variables. However, it has some clear weaknesses if you try to use it to handle Unix timestamps.</p>
<p>For example, suppose your dataset only contains Sundays at 12am. The model would have to learn that the timestamps it generates should satisfy <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">mod</span> <span class="pre">259200</span> <span class="pre">=</span> <span class="pre">0</span></code>. Normalizing your timestamps to <code class="docutils literal notranslate"><span class="pre">[-1.0,</span> <span class="pre">1.0]</span></code> range doesn’t necesssarily help - it might even hurt!</p>
<p>Therefore, we’re looking for some way to specify a distribution over timestamps that: 1. Makes it easy for the model to learn cyclical and seasonal properties 2. Has a fixed scale which doesn’t require additional/arbitrary normalization 3. Can be efficiently sampled from. 4. Has a functional form which allows us to log-likelihood of the data and then compute the gradients.</p>
</div>
</div>
</div>
<div class="section" id="Modeling-Timestamps">
<h2>Modeling Timestamps<a class="headerlink" href="#Modeling-Timestamps" title="Permalink to this headline">¶</a></h2>
<p>The <strong>rejection sampling</strong> framework gives us the tools to sample from an unnormalized probability distribution where (1) we know the range of possible x-values and (2) we know the maximum value of the pdf. Using rejection sampling, we can avoid having to specify a well-formed pdf/cdf at the cost of a little extra computation.</p>
<div class="section" id="Motivating-Example">
<h3>Motivating Example<a class="headerlink" href="#Motivating-Example" title="Permalink to this headline">¶</a></h3>
<p>This allows us to think of our “distribution” over timestamps as a scoring function such as:</p>
<div class="math notranslate nohighlight">
\[P(\texttt{timestamp}) \propto
    a \cdot I[\texttt{is_winter}] +
    b \cdot I[\texttt{is_monday}] +
    c \cdot I[\texttt{is_sunday}]\]</div>
<p>where <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span> are the parameters of the distribution and must be in range <span class="math notranslate nohighlight">\([0.0, 1.0]\)</span>.</p>
<div class="section" id="As-Input">
<h4>As Input<a class="headerlink" href="#As-Input" title="Permalink to this headline">¶</a></h4>
<p>When providing a timestamp as input to the model, we simply set the parameters equal to the corresponding indicator variable. For example, if our value is <code class="docutils literal notranslate"><span class="pre">1578182400</span></code>, then we set <span class="math notranslate nohighlight">\(a=1.0\)</span> since the date is in the winter, <span class="math notranslate nohighlight">\(b=0.0\)</span> since it is not a Monday, and <span class="math notranslate nohighlight">\(c=1.0\)</span> since it is a Sunday.</p>
<p>Note that in this example scoring function, all Sundays in the winter are equally likely (i.e. they all receive the same score and are therefore equally likely to be sampled).</p>
</div>
<div class="section" id="As-Output">
<h4>As Output<a class="headerlink" href="#As-Output" title="Permalink to this headline">¶</a></h4>
<p>When these parameters are produced by the model, they specify a scoring function which takes a timestamp and returns a real-valued score between in the range <span class="math notranslate nohighlight">\([0.0, 3.0]\)</span> which is proportional to the value of the pdf at the given timestamp. Using rejection sampling, we can sample from this pdf and obtain timestamps!</p>
<p>For example, suppose our model produces <span class="math notranslate nohighlight">\(a=1.0\)</span>, <span class="math notranslate nohighlight">\(b=1.0\)</span>, <span class="math notranslate nohighlight">\(c=1.0\)</span>. Intuitively, this would suggest that we are more likely to sample a timestamp that is in the winter and on a Monday.</p>
</div>
</div>
</div>
<div class="section" id="Implementation">
<h2>Implementation<a class="headerlink" href="#Implementation" title="Permalink to this headline">¶</a></h2>
<p>Here’s a quick-and-dirty implementation of the scoring function, rejection sampling, and corresponding transform/sample steps. Don’t pay too much attention to this, we can definately do a better job of making it more readible and computationally efficient.</p>
<p><strong>Aside: Why isn’t this an RDT?</strong> <em>Well, the main distinction between this and an RDT is that the “reverse transform” involves sampling (and is not deterministic/”reversible”.) However, if you want to package it as part of RDT, I’m fine with that. This document is intended to describe the mathematical framework for modeling timestamps as opposed to recommending some specific software design / structure.</em></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">EchoTime</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">to_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">7</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">()]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">from_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">max_tries</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_tries</span><span class="p">):</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1535730073</span><span class="p">,</span> <span class="mi">1555730073</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c1"># max value = 1.0</span>
            <span class="k">if</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">timestamp</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">target_column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transform the target datetime column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span> <span class="o">=</span> <span class="n">target_column</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">to_params</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">target_column</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">row</span><span class="p">[</span><span class="n">target_column</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt_columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">target_column</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">param</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dt_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">target_column</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
            <span class="n">new_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt_columns</span><span class="p">:</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">row</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">new_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Demo">
<h2>Demo<a class="headerlink" href="#Demo" title="Permalink to this headline">¶</a></h2>
<p>Recall our example dataset from earlier where we discovered that we had more customers on Saturdays than Tuesdays. Let’s try to model this dataset using Copulas.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>nb_customers</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1577836800</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1578182400</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1578441600</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1578787200</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>First, we’ll write a simple helper function which summarizes the dataset. We’ll use this function to generate a human-readible printout which highlights some of the properties of the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">daysOftheWeek</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Monday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wednesday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thursday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Friday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Saturday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sunday&quot;</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">daysOftheWeek</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">weekday</span><span class="p">()]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;nb_customers&quot;</span><span class="p">:</span> <span class="s2">&quot;avg_nb_customers&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">summarize</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_nb_customers</th>
    </tr>
    <tr>
      <th>day_of_week</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Saturday</th>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Tuesday</th>
      <td>1.5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As expected, we see that (1) our dataset only contains Tuesdays and Saturdays and (2) on average, there are much more customers on Saturday than Tuesday.</p>
<div class="section" id="Direct-Modeling">
<h3>Direct Modeling<a class="headerlink" href="#Direct-Modeling" title="Permalink to this headline">¶</a></h3>
<p>Let’s see what happens if we directly pass this data to Copulas. Note that we could also use something RDT to transform the datatime values; however, the current datetime transformer in RDT simply transforms it into Unix time so it’s essentially a no-op in this case (since there are no missing values).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">copulas.multivariate</span> <span class="kn">import</span> <span class="n">GaussianMultivariate</span>
<span class="n">copula</span> <span class="o">=</span> <span class="n">GaussianMultivariate</span><span class="p">()</span>
<span class="n">copula</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">synthetic_df</span> <span class="o">=</span> <span class="n">copula</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">summarize</span><span class="p">(</span><span class="n">synthetic_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_nb_customers</th>
    </tr>
    <tr>
      <th>day_of_week</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Monday</th>
      <td>9.233596</td>
    </tr>
    <tr>
      <th>Saturday</th>
      <td>8.012633</td>
    </tr>
    <tr>
      <th>Sunday</th>
      <td>6.315706</td>
    </tr>
    <tr>
      <th>Wednesday</th>
      <td>4.472315</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As you can see here, the synthetic data (1) contains timestamps from other days which do not belong and (2) does not capture the property that there are more cusomers on Saturdays than Tuesays.</p>
</div>
</div>
<div class="section" id="Using-EchoTime">
<h2>Using EchoTime<a class="headerlink" href="#Using-EchoTime" title="Permalink to this headline">¶</a></h2>
<p>Now let’s see what happens if we first transform the column using EchoTime.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">copulas.multivariate</span> <span class="kn">import</span> <span class="n">GaussianMultivariate</span>

<span class="n">et</span> <span class="o">=</span> <span class="n">EchoTime</span><span class="p">()</span>
<span class="n">copula</span> <span class="o">=</span> <span class="n">GaussianMultivariate</span><span class="p">()</span>
<span class="n">copula</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">et</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">))</span>
<span class="n">synthetic_df</span> <span class="o">=</span> <span class="n">et</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">copula</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">summarize</span><span class="p">(</span><span class="n">synthetic_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/anaconda3/envs/deepecho/lib/python3.7/site-packages/numpy/core/fromnumeric.py:56: FutureWarning: Series.nonzero() is deprecated and will be removed in a future version.Use Series.to_numpy().nonzero() instead
  return getattr(obj, method)(*args, **kwds)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>avg_nb_customers</th>
    </tr>
    <tr>
      <th>day_of_week</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Saturday</th>
      <td>9.086956</td>
    </tr>
    <tr>
      <th>Tuesday</th>
      <td>1.080311</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note that we are now able to capture both properties! The synthetic dataset only contains Tuesdays and Saturdays and, on average, there are much more customers on Saturday than Tuesday.</p>
</div>
<div class="section" id="Takeaways">
<h2>Takeaways<a class="headerlink" href="#Takeaways" title="Permalink to this headline">¶</a></h2>
<p>The EchoTime methodology - which consists of defining a distribution over timestamps using a scoring function and applying rejection sampling - is a powerful, flexible, and effective approach to modeling timestamp data.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/deepecho.html" class="btn btn-neutral float-right" title="deepecho package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="04_Event_Data.html" class="btn btn-neutral float-left" title="Event-based Data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Kevin Alex Zhang

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>